## Deep Learning for Medication Recommendation: A Systematic Survey

### 研究方法

本文使用的研究方法是系统调查。作者对有关基于深度学习的药物推荐方法的文献进行了全面综述。他们分析和比较了药物推荐中使用的各种深度学习模型的性能，确定了该领域的趋势和挑战，并报告了评估药物推荐模型时使用的最常见的数据集和指标。作者还根据其分类方法对基于深度学习的药物推荐模型进行了分类，并对每个类别进行了详细分析。

#### 专有或缩写名词

 **EHR** ：电子健康病历

**DDI**：drug-drug interactions

**DL**：深度学习

**DRL**：深度强化学习

**DNN**：深度神经网络

**SRL-RNN**：带RNN的监督强化学习

**KG**是指知识图谱（Knowledge Graph）。知识图谱是一种用于表示实体、属性和实体之间关系的图形化知识表示方式，通常使用图形或网络来表示实体和它们之间的关系。知识图谱可以包含大量的结构化和半结构化数据，以及非结构化数据，如文本和图片等。

**Content-based（CB）过滤**是一种推荐方法，它考虑物品的特征，例如类型或关键字，以向用户推荐类似的物品。

**Collaborative Filtering（CF）**是一种推荐方法，它使用用户的过去行为和他们与其他用户的相似性来推荐物品。

**混合过滤（hybrid filtering）**将基于内容和协同过滤方法结合起来，以提供更准确和多样化的推荐。

**Cold start**是指在推荐系统中，新用户或新物品加入系统时，由于缺乏足够的个人或物品数据，导致无法进行准确的推荐的情况。

**MR模型**通常指MapReduce模型，是一种用于大规模数据处理的编程模型。它通过将数据分解为多个小块，分发到多个计算节点上进行并行处理，最后将结果合并得到最终的输出。MapReduce模型被广泛应用于分布式计算、数据挖掘、机器学习等领域。

**编程模型**是指一种用于描述计算机程序执行方式的象概念。它可以描述程序中各个组件之间的关系，以及程序如何访问、处理和存储数据。

<u>TransD，GCN，GNN和GAN都是在各种自然语言处理任务中使用的机器学习模型。</u>

**TransD**是一种知识图谱嵌入模型，通过将实体和关系投影到超平面上来学习知识图谱中的向量表示。
**GCN**或图卷积网络是一种神经网络，可以在图形数据结构上操作。它经常用于图中的节点分类和链接预测等任务。
**GNN**或图神经网络是一个更一般的术语，包括各种在图形数据结构上操作的神经网络类型。
**GAN**或生成对抗网络是一种神经网络，由生成器和鉴别器两个组件组成。生成器学习生成类似于真实数据的数据，而鉴别器学习区分真实数据和假数据。GAN已经被用于自然语言处理中的文本生成和风格转移等任务。

 **binary cross entropy**：二元交叉熵

 **mean square error loss functions**：均方误差损失函数

**SGE**： synergy graph encoding （协同图编码）

负训练样本：负训练样本是指在机器学习中用于训练模型的一类数据样本，其标签或输出结果为负数或表示负面情况的标签。这些样本通常用于帮助模型识别和区分正面和负面情况，以便更准确地进行分类和预测。

**MLP-based MRS**是一种基于多层感知器（MLP）的多轮对话响应选择（MRS）模型。该模型使用MLP来对输入的对话历史进行建模，然后根据历史信息生成响应。与传统的基于检索的MRS不同，MLP-based MRS不需要预定义的候选响应集合，而是可以在训练时学习到响应的生成。该模型已被广泛应用于智能客服和聊天机器人等领域。

**Vanilla GRU**是一种循环神经网络（RNN）的变体，GRU代表门控循环单元（Gated Recurrent Unit）。相比于传统的RNN，GRU使用了门控机制来控制信息的流动，从而更好地捕捉长期依赖关系，并且具有更少的参数。Vanilla GRU是最基本的GRU模型，通常用于序列数据的建模和处理。

**LSTM-DE**是一种基于长短时记忆网络（LSTM）的对话模型，其中DE代表对话扩展（Dialogue Expansion）。该模型通过使用LSTM来对对话历史进行建模，并使用对话扩展机制来生成响应。对话扩展机制是指在生成响应时，将响应作为新的输入添加到对话历史中，从而使模型能够更好地捕捉上下文信息和长期依赖关系。LSTM-DE模型已被广泛应用于智能客服和聊天机器人等领域。

**AMANet**是指Attention-based Memory Augmented Neural Network，是一种基于注意力机制和记忆增强的神经网络模型。该模型使用外部存储器来存储历史信息，并通过注意力机制来选择存储器中最相关的信息。

**DPR**是指Dense Passage Retrieval，是一种用于自然语言处理中的文本检索模型。DPR模型使用双塔结构，其中一个塔用于编码问题，另一个塔用于编码候选答案。DPR模型还使用密集连接层来计算问题和候选答案之间的相似度得分，并使用倒排索引来加速检索。DPR模型已经在问答系统、信息检索和对话系统等任务中得到了广泛应用。

**G-BERT**是一种基于BERT模型的语言模型，它是为了更好地理解和生成句子而设计的。G-BERT是Google开发的，它使用了大量的训练数据和计算资源来提高语言理解的准确性和效率。

**MedRec**是一种基于区块链技术的电子病历系统，可以帮助医疗机构更安全、更高效地管理患者的医疗记录。MedRec使用区块链来保护数据的安全性和隐私性，同时也可以提高数据的可追溯性和透明度。

**Accard**（Accuracy）是指分类模型正确预测的样本数占总样本数的比例。

**F-score**是综合考虑了模型的精确率和召回率的指标。精确率（Precision）是指被预测为正例的样本中实际为正例的比例，召回率（Recall）是指实际为正例的样本中被预测为正例的比例。F-score是精确率和召回率的调和平均数。F-score的取值范围在0和1之间，值越大表示模型性能越好。

**RMSProp**是一种优化算法，用于在深度学习中更新神经网络的权重。它是Adaptive Learning Rate方法的一种变体。RMSProp的全称是Root Mean Square Propagation，它使用指数加权移动平均来计算梯度的平方的无偏估计，并使用该值来调整学习率。这种方法可以使学习率在训练过程中自适应地变化，以更好地适应每个权重的更新速度。具体来说，RMSProp使用一个衰减系数来控制历史梯度的影响，同时使用一个小常数来防止除以零。RMSProp的优点在于可以加速收敛并提高模型的泛化能力，尤其是在处理稀疏数据时效果更好。

**AdaGrad**是一种优化算法，用于在深度学习中更新神经网络的权重。它是Adaptive Learning Rate方法的一种变体。AdaGrad的全称是Adaptive Gradient Algorithm，它使用过去所有梯度的平方和来调整学习率，使得每个参数的更新都有不同的学习率。

### ABSTRACT

该论文是关于使用电子健康记录（EHR）向患者推荐药物的。

#### 1.简介

内容：  因为制药公司的丰富及其不断增长的药物数量对医生的药物处方与患者的诊断和病史产生了巨大影响。EHR提供了患者病史的全面情况，以便医生在选择药物并将其纳入处方时能够做出明智的决定。

最近EHR质量的提高吸引了研究人员，研究人员采用了深度学习（DL）来制定高质量的药物建议。解决传统推荐方法的数据稀疏、冷启动、缺乏个性化等问题。

1.表 1 比较了药物推荐模型的研究。 2.一些研究对技术方面和最新模型的覆盖范围有限。 3.一篇新的评论对基于 DL 的模型进行了分类，涵盖了优化方法和趋势。 4.但是，有些研究没有涵盖具体建议的细节和信息来源。

![image-20230714103201393](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230714103201393.png)

![image-20230714103247500](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230714103247500.png)

**本文的主要目的和主题**：对最新的基于dl的MR模型进行详细的回顾和深入的分析。

**Coverage and contributions**

本研究通过报告2013-2022年间发表的37个采用深度神经网络的MR模型，对基于dl的MR系统的文献进行了全面回顾。这篇综述通过报告基于dl的MR模型的优势、局限性和趋势。

#### 2.模型分类

分类基于使用的平台(离线还是在线)、考虑的数据特征、使用的深度神经网络、面临的问题和挑战、采用的优化方法以及推荐类型(如个性化还是非个性化)。

![image-20230714131221003](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230714131221003.png)

![image-20230815202010784](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230815202010784.png)

![image-20230815202023905](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230815202023905.png)

![image-20230815202038663](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230815202038663.png)

##### 2.1 Platform

**平台**：平台这个词是指MR模型是否已经部署在一个真实的在线推荐系统中。

##### 2.2 Information Factors

**Medication history** ：这是所探索的MRs中采用的最重要因素，所有37个模型都采用了这一因素。

**Time/Temporal dynamics**：它要求在推荐药物时考虑病人的时间状况和他们到医院就诊的情况。看病拿药一般根据临床反应，但是以前的指标和病例也比较重要。

**Demographic information**：人口统计数据包括患者的性别、年龄、种族、住址、教育程度和其他相关细节。

##### 2.3 Methodologies and Models

**Embedding methods**：嵌入方法是一种在自然语言处理中常用的技术，用于将单词表示为低维连续向量。

用途：(1)作为另一个深度学习网络的输入，(2)通过利用用户兴趣生成基于最近邻居的推荐，以及(3)帮助可视化概念和它们之间的关系。

嵌入模型分为三类，即word/document[54]、graph/network[55,2]和knowledge graph (KG)[56]嵌入。

**词嵌入**常使用 word2vec , doc2vec , and BERT . 

使用**图嵌入**方法，捕获节点(药物、患者、程序、诊断等)之间有意义的关系，这取决于嵌入空间中节点间的差异。

**知识图(KG**)是一种用节点表示实体的异构图，这些实体之间的关系用节点间的边表示。模型有两个模块，第一，图嵌入，学习其实体和关系的表示;其次是推荐模块，它可以估计患者对某种药物的偏好，这样医生就可以在有吸引力的情况下开出处方。

**examples** 

（1）GAMENet 

通过GCN模块嵌入药物-药物相互作用(DDI)的KG，该模型在每个图上分别应用两层GCN来学习药物组合和ddi的扩展嵌入。通过该模型，将纵向病历联合学习为电子病历图。

（2）RETAIN [10] and DMNC [14] 

证实了时序数据在药物推荐中的重要性

（3） G-BERT

利用GCN利用医学本体学习医学代码的初始嵌入，G-BERT应用预测层来生成药物建议。与GAMENet和基于注意力的RETAIN[10]模型相比，它获得了更好的Jaccard和f分数，这表明将分层本体信息与预训练过程结合在一起可以改善预测。

（4）MedGCN 

需要预测实验室检测结果的缺失值，例如，第2次、第3次和第4次，并为第3次和第4次推荐全部或部分药物清单。

MedGCN利用实体(就诊、患者、药物和实验室测试)之间的关系，使用其固有特征的异构图(称为MedGraph)。对于图中的每个实体，它学习基于GCN的向量表示[63]。为了处理不同的实体，该模型将异构图分解为多个子图，每个子图拥有一种类型的边(关系)，并使用单个邻接矩阵来表示它。在每个GCN层中，该模型将所有子图中每个节点的表示聚合，以学习其最终嵌入。

![image-20230719105141969](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230719105141969.png)

此外，还使用二元交叉熵和均方误差损失函数进行药物推荐和采用交叉正则化策略来缓解多任务训练的过拟合问题，即推荐药物和输入实验室测试。

（5）SMGCN 

SMGCN[37]提出了一种多层神经网络来模拟草药与症状之间的相互作用，用于推荐草药。

综上所述，嵌入模型利用丰富的语义，利用内容和图结构信息生成药物、患者和相关节点/实体的语义保留表示，有助于生成精确的推荐。

**Deep reinforcement learning techniques**

（6） LEAP (LEArn to Prescribe) 

深度强化学习(DRL)为机器和软件代理模仿人类的学习能力，以便它们也可以从自己的行为中学习。采用DRL的模型对代理在环境中采取的行动进行惩罚或奖励[67]。


帮助代理实现其目标的行为会得到奖励，即强化。如果一个agent在时间t执行一个动作，环境会在时间t给agent分配一个量化的激励，并在动作的位置改变自己。agent重复执行这些动作，直到到达某个终端位置[68]。这些模型最适合于动态和不断变化的环境，比如药物建议。

Zhang等[3]提出了LEAP (LEArn to prescription)模型，学习药物类别与多种疾病之间的联系，并在推荐药物时捕捉药物类别之间的依赖关系。

他们使用循环解码器(GRU)对标签依赖关系和基于内容的注意力进行建模[69]，以便捕获标签实例映射。

（7）CompNet (Combined Orderfree Medicine Prediction Network)

CompNet是一种图卷积强化学习模型，可以减轻对药物序列的不合理假设，从而利用它们之间的相关性。

CompNet公司利用药品之间的不良反应和相关关系，建立了一个药品知识库来保存动态的药品知识，可以根据当前预测的药品自适应地调整药品知识。

（8）SRL-RNN

SRL-RNN为学习个体、疾病和药物之间的复杂关系提供了一个非政策行为者批评框架。行动者网络根据患者不断变化的状态推荐时变药物，在这种情况下，对医生做出的决定的监督有助于确保安全的行动，从而通过考虑医生的知识来加速学习过程。批评家网络通过估算行动者网络对应的行动值来鼓励或阻止推荐的治疗方法。

将SRLRNN模型用LSTM扩展，以处理实际应用中完全观察状态的问题，其中总结整个历史观察，以捕获患者的时间和纵向记录的依赖性。

与PMDC-RNN和LEAP模型相比，SRL-RNN给出了更好的预测，因为它使用了强化学习，可以很好地推断非最优处方的最优策略。

**Recurrent neural net works**

与前馈神经网络不同，rnn采用输入(input)、输出(output)、遗忘(forget)等栅极来保存有用的数据和长期依赖关系。

为了解决传统rnn遇到的梯度消失问题[72]，rnn的扩展，即gru和lstm引入了门。其中，LTSM使用输入、输出和遗忘门来保留或丢弃信息。另一方面，gru使用隐藏状态传递信息，并使用复位和更新门，其功能类似于LSTM的更新和忘记门，而复位门将重要信息转发到下一层。

<u>RNN模型及其变体捕获了长期依赖关系和时间动态，因此更适合用于药物推荐，因此可用于各种模型.</u>

 **LSTM-DE**：构造一个隐时间序列来模拟预测序列，另一个隐时间序列来模拟体检结果。相应的，一个隐藏序列分别反映治疗过程和恢复进展。然后，三种异构LSTM模型利用了各种医学序列之间的相互作用，其中一个完全连接的异构LSTM使隐藏状态的相互作用保持双向并行。部分连接的异构LSTM保持了从隐藏物理状态到处理隐藏状态的相互作用。将体检结果直接施加到分解后的LSTM模型的处理隐藏状态上。最后，该模型结合了隐藏状态下的人口统计和诊断来预测下一次的处方。

**RETAIN model** ：为了产生更稳定的注意力，它通过观察病人过去的访问，以反向的时间序列来代表医生在遇到病人时的行为。通过这种方式，它可以识别重要的访问并量化有助于预测的访问特定属性。

![image-20230815123150750](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230815123150750.png)

![image-20230815123208606](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230815123208606.png)

![image-20230815123214959](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230815123214959.png)

**DMNC**：在这里，使用三个神经控制器和两个外部存储器，从而形成双存储器神经计算机。为了对视图内交互建模，每个视图都有自己的控制器和内存。控制器负责读取输入事件，更新内存，在每个时间戳从内存中读取向量，并根据其当前隐藏状态生成输出。视内相互作用有两种类型：early-fusion and late-fusion memories。

在编码过程中，这两个存储器之间没有信息交换，因为 late-fusion mode使每个视图的存储器空间保持独立和分离。

在解码过程中，使用记忆的读取值来生成面谈知识（ inter-view knowledge）。在这里，与后期融合不同，视图共享内存的寻址空间以确保信息共享。

这种异步共享是通过在缓存中临时保存每个时间步骤的写值来提供的，这样可以同时将来自不同时间步骤的信息写入内存。解码过程在存储器上采用写保护机制，提高了推理效率。每个编码器都使用LSTM将嵌入向量转换为h维向量。虽然DMNC使用基于注意力的DNC块，使其能够识别序列之间的相互作用，但它忽略了在病史访问中考虑药物。

**DPR**：在推荐药物包装时考虑了可能受患者病情影响的药物内部相互作用。更具体地说，采用一种预训练方法，使用协同过滤来获得药物和患者的初始嵌入。然后生成考虑领域知识和医疗记录的DDI图。采用加权图(DPR- wg)和属性图(DPR- ag)两种变体的药物包装推荐(DPR)框架，其中每个相互作用分别通过分配的权重或属性向量进行描述。

**MeSIN**通过引入一个互动的、多层次的选择网络来推荐药物，解决了电子病历数据的复杂性，包括大量的患者记录、就诊情况和连续的实验室结果。

**交互式LSTM**通过一个增强的输入门和一个校准的记忆增强单元来增强电子病历数据中多层次医疗序列之间的相互作用。注意选择模块根据与每次入院时建议的药物的相关性，为各种医疗代码表示分配灵活的注意分数。最后，一个**全局选择融合模块**将来自多个来源的信息嵌入到患者的表示中，以推荐药物。

**MICRON**与现有的MR模型(包括Gamenet[21]和Retain[10])的不同之处在于，它在局部学习顺序信息，而后者使用rnn使用全局顺序模式。MICRON[50]考虑到两次连续就诊，即(t - 1)th和th，局部学习时序数据，并逐次传播，保持患者的纵向信息。

**ConCare**使用自关注机制[76]捕捉特征之间的相互依赖性，其中使用固定位置编码为时间戳提供相对位置信息[77]。采用多通道GRU分别嵌入时间序列特征。一种更好的编码方法是通过观察其他特征来寻找线索。此外，它还采用了多头机制，通过多表示子空间来改进注意层。

ConCare自适应地捕捉临床特征之间的关系，为不同健康状况的患者提供个性化建议。它的性能优于基于位置编码的方法，如SAnD[77]、Transformer-Encoder、基于注意力的RETAIN[10]和时间感知方法，如T-LSTM[74]，这表明在全局视图中单独考虑每个特征的时间衰减影响远比直接衰减所有访问的隐藏记忆要好得多。

**Convolutional neural network.** 

**SD_CNN**使用CNN[83]框架学习患者的相似性[84]。该框架通过嵌入层将患者A的独热特征矩阵映射到一个低维稀疏矩阵。将最大池化和卷积应用于每个矩阵，并将其特征向量聚合为一个复合向量。患者b通过匹配矩阵和转换层得到相同的嵌入参数和CNN参数，这些患者的复合向量得到一个相似特征向量，通过softmax层得到他们的相似概率。

 **TAHDNet** 包含三个模块： 1D-CNN, transformer, and time-aware block.

该模型使用1D-CNN进行局部依赖，使用transformer进行全局依赖，使用 time-aware block进行dynamic time-aware attention，以学习纵向EHR数据的分层依赖关系(其中每个记录都表示为多变量序列)。

通过连接这些块的输出，生成每个患者的新表示，然后将其馈送到预测层以推荐药物。该模式使用DDI loss来共同确定最终推荐。它采用transformer structure ，采用预先训练的基于transformer的模块，遵循G-BERT[25]，考虑整个患者记录，对全局依赖性进行建模。

**Generative adversarial networks.**

生成式对抗网络(GANs)采用无监督学习方法，自动发现和学习数据中的模式或规律，使模型能够输出或生成可能从原始数据中提取的新示例。

这些模型采用一种智能的方法，通过使用两个子模型(包括生成器和鉴别器)来训练生成模型。前者生成新的样本，后者将它们分类为真实的(即来自域)或虚假的(即生成的)。它们以对抗的方式进行训练，直到后者被愚弄了大约一半的时间，这意味着前者正在产生可信的样本。

**ARMR模型**使用两个GRU网络[71]来构建一个编码器，该编码器利用患者诊断和程序来生成鲁棒的患者表征。然后，它使用键值记忆网络[86]将历史表征和相关药物作为成对保存，并在记忆网络上执行多跳读取，从历史电子病历中获取基于病例的相似信息，用于更新患者嵌入。它结合编码器和记忆网络[86]构建药物推荐(MedRec)模块。该模型通过将编码器作为生成器与鉴别器融合形成GAN模型，并将DDI率小于预设阈值的患者表征作为真实数据处理，使GAN模型能够塑造编码器生成的患者表征的分布以降低DDI。MedRec和GAN在每个小批中进行联合训练，目标有两个:一个是传统的错误标准，对应于推荐药物，另一个是对抗性训练标准，用于规范分布。通过这种方式，ARMR学习有意义的患者表征，同时调节数据分布以保持低DDI。

为了应对DDI的致命副作用，**SARMR**对原始电子病历进行处理，得到患者在特征空间中与安全用药组合相关的表征的概率分布。然后，它对抗性地正则化这些分布，通过将知识应用为真实数据来降低DDI率。该模型将不同DDI率的患者作为不同的队列进行治疗和规范化，从而避免了将其作为单一队列处理对泛化的不利影响。与SARMR相比，基于rnn的基线(包括LEAP、RE-TAIN和DMNC)在捕捉最大程度影响患者健康状态的重要因素方面受到限制。**GAMENet**使用额外的DDI知识作为记忆组件来减轻DDI，然而，它对患者和医生之间互动的推理能力有限，并且使用Jaccard和F-score的结果较低。

**Attention networks and transformer-based models.**

注意网络在研究人员中非常受欢迎[87,88]，因为它们通过更多地关注突出信息来产生强大的推荐[89,90]。

**RETAIN**以相反的时间顺序分析病人过去的访问，使注意力产生更稳定。因此，RETAIN确定了最重要的访问，并量化了有助于药物预测的访问特定特征。现有的**PREMIER、GAMENet、SRL-RNN**等模型大多提出了少数多次就诊患者的纵向电子病历，而忽略了许多单次就诊患者的纵向电子病历，导致选择偏倚。

**G-BERT**在精度、召回率、AUC (PR-AUC)、F1和Jaccard分数方面优于竞争基准，包括RETAIN、LEAP和GAMENet。**G-BERT**通过使用图注意网络[65]使用本体嵌入表示医疗代码的层次结构来解决这些问题。它使用BERT[76]对EHR的每次访问进行预训练，以便考虑即使只有一次医院访问的EHR数据。它调整了预先训练的访问和表示，以便对多次访问的患者的纵向电子病历(访问次数)进行下游预测。

**COGNet**建议通过编码器-解码器生成网络考虑患者当前健康状况的药物组合。编码器包含两个基于变压器的网络[76]，该网络使用多头自关注机制对诊断和程序信息进行编码，两个图卷积编码器[63]用于对药物之间的关系进行建模。复制模块根据以前的访问评估当前的健康状况，以复制可重复使用的药物，为当前访问处方药物，考虑到健康状况的变化。

**分层选择机制**结合访问和药物水平得分来计算每种药物的复制概率。复制模块优于其他同类产品，包括LEAP, RETAIN, DMNC, GAMENet, MICRON和safeddrug，因为在临床实践中，对同一患者的建议是密切相关的。与COGNet相比，这些基线模型忽略了患者的历史访问信息。此外，他们不考虑同一病人的药物建议之间的关系，也无法捕捉到长期就诊的依赖性。

**Hybrid and other networks.** 

混合网络集成了两种或多种深度学习方法，以获取其固有的优点，并减轻其在产生稳健的药物建议方面的潜在局限性。

**AMANet**模型无法通过时间序列学习网络充分利用捕获的进化信息，包括疾病进展，如果利用这些信息，可能会产生更强大的推荐[11]。

**ARMR模型**提出了一个带有两个GRU网络的编码器[73]，以利用诊断和程序来产生患者表征。该模型通过在键值记忆网络中存储历史表征和关联用药来更新患者表征[93]，并通过多跳读取从历史电子病历中提取基于病例的类似数据来更新患者表征。这就产生了一个药物推荐(MedRec)模块，该模块由编码器和记忆网络组成。该模型将编码器作为生成器与鉴别器集成以生成GAN模型[85]。GAN模型通过利用DDI率小于预设阈值的患者表征作为真实数据来塑造编码器产生的患者表征的分布，从而降低DDI。同时，MedRec和GAN在每个小批中进行联合训练，以获得推荐药物的传统错误标准和调节分配的对抗训练标准。

该策略允许模型学习有意义的患者表示，同时保持低DDI，从而获得高质量的药物推荐。

避免致命的DDI是推荐药物的突出挑战之一。**SARMR模型**解决了这个问题，该模型处理原始电子病历，以获得安全药物组合的患者代表的概率分布。它通过使用知识作为真实数据对抗性地正则化患者表示的分布来降低DDI。它使用不同DDI率的患者作为不同的队列，并将其规范化，以避免对泛化的负面影响，如果将他们作为单一队列治疗，可能会产生负面影响。首先，通过GRU编码EHRs对患者与医生之间的互动进行建模[73]，然后构建键值记忆神经网络[93]，键值表示入院，值表示相应的药物。其次，使用最近一次录取的表示作为查询，在MemNN[93]上进行多次读取，并将读取结果嵌入GCN[63]模块。考虑到更新的查询，建议使用药物。

接下来，它使用所有患者的记录，不考虑他们的DDI率，推荐药物，并在第一步获得的表示的基础上用GAN规范对抗分布[85]，以实现DDI的降低和有效的药物组合。

它采用编码器-解码器结构来预测下一个用药顺序，并利用自关注将静态和动态相结合。同时，它通过利用三个图表嵌入和使用关于药物的知识和医生的经验，即顺序图、DDI图和共现图，以表示药物的顺序关系、冲突和共现。编码器有三个模块，即医疗嵌入模块，该模块采用自关注模块[76]和RNN捕获顺序信息;使用Neural ODE对特定时间戳的不规则时间序列数据进行建模的动态编码模块;以及患者聚合模块，该模块使用简单的线性映射，通过聚合顺序用药、静态和动态特征来建模患者的状态。编码器通过从不规则采样的时间序列数据中提取用药策略和患者状态来生成当前时间戳下患者的表示。解码器采用药物生成器和图形注意模块。它使用患者表示和图表在时间戳t + 1推荐药物，这些图表建立了用药史中药物之间的关系。

**TAHDNet模型**通过分层学习，在局部和全局层面捕捉药物与患者之间的依赖信息。包括变压器、时间感知和1D-CNN模块。它使用1D-CNN[83]来学习患者的局部表征，并使用基于自适应变压器的学习[25]，通过自监督预训练过程来学习患者的全局表征。它通过采用具有单调和周期性衰减的融合时间衰减函数来模拟疾病进展，从而对疾病进展进行更现实的评估。该模型优于几种基准模型，包括LEAP[3]、RETAIN[10]、G-BERT[25]和GAMENet[21]。这里，LEAP是基于实例的，其执行速度低于RETAIN时态方法。这提倡时间数据在电子病历中的重要性。TAHDNet提供了更好的结果，因为它能够从电子病历中提取尽可能多的细节，同时降低噪音。

![image-20230816161137919](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230816161137919.png)

**COGNet模型**通过采用基于编码器-解码器的生成网络，按顺序推荐合适的药物。它通过在编码器网络中编码她以前访问的所有医疗代码来表示患者的历史健康状况。它通过编码来自第一次访问的诊断和程序代码来表示患者当前的健康状况。它采用解码器逐个生成第t次就诊的用药程序代码，以表示患者当前的药物组合建议。在每个解码步骤中，解码器通过程序、诊断和药物收集信息，以建议下一个药物。如果当前访问的疾病与以前的访问一致，复制模块立即从历史药物组合中复制相关药物。

换句话说，复制模块扩展了基本模型，通过比较历史和当前就诊的健康状况，然后复制可重复使用的药物，根据病情变化为当前就诊开出处方。诊断和程序编码器是基于变压器的网络[76]，具有不同的参数。

患者症状和药物的集合定义了药物推荐器的输入，但是，该输入仍然缺乏将这两个实体联系起来的足够细节。**MedRec**通过将药物及其属性图的知识纳入其模型，将药物与症状联系起来，解决了这一问题。创建了症状和药物的医学KG，从而使其具有更丰富的代表性。

**MedRec**首先使用多关系GCN[63]学习实体和关系的嵌入，并使用链接预测任务的目标函数对模型进行优化。同样，药物和症状的嵌入也会产生。它将注意机制与每个症状的嵌入融合在一起，产生一个综合征表征。MedRec采用GCN[63]得到属性图的嵌入，并与医学KG结合使用，生成一种药物的整体表示。

最后，通过学习药物与证候的相互作用，生成预测分数。

![image-20230816162159749](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230816162159749.png)

一般情况下，药物推荐人将药物视为单个项目，在尽可能保留ddi的情况下，忽略了将药物作为一组项目进行推荐的独特性要求。**4SDrug**解决了这个问题，它通过对药物和症状进行集对集比较来推荐药物，设计面向集的表示和相似性测量。4SDrug优于GAMENet和LEAP等竞争对手。4SDrug具有更好的计算空间和复杂度，并且兼容高效的小批量训练。GAMENet[21]由于内存大，需要更多的空间，而LEAP[3]由于顺序建模，计算复杂。

**药物集模块**使用基于交集的药物集增强和混合DDI惩罚机制来推荐药物集，以确保药物集小而安全的原则。图9展示了该建议的一个示例，显示了两个患者Jack和Lisa有相似的症状，如发烧、咳嗽、发冷和头痛，因此相同的疾病，即病毒性流感的可能性最大。因此，他们将被推荐相同的药物。

##### 2.4 Optimization Methods

通过优化，我们的意思是找到一种方法来发现那些参数或权重的值，从而减少错误的机会，并在将输入映射到输出时提高模型精度。

（1）梯度下降

（2）随机梯度下降

（3）Momentum

动量扩展梯度下降，在适当的方向上加速随机梯度下降，使有噪声梯度的振荡保持在最小

（4）RMSProp

Root Mean Squared Prop是另一种自适应学习率方法，它试图改进AdaGrad[98]，采用梯度平方的累积和。RMSProp采用指数移动平均线。两者都有相同的第一步，然而，RMSProp将学习率除以指数衰减的平均值[99]。

（5）Adam

Adam[99, 97]结合了动量和RMSProp的优点来计算每个参数的自适应学习率。它存储了以前平方梯度的衰减平均值，并保持了过去梯度的平均值，类似于动量的平均值。

![image-20230817124307665](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817124307665.png)

#### 3.EVALUATION METHODS

（1）召回率

![image-20230817125613296](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817125613296.png)

在人工智能中，**Top-k**通常用来表示在给定的一组选择中，选择前k个最相关或最可能的选项。例如，在图像分类中，Top-k表示模型在给定一张图片时，预测结果中排名前k的类别。大多数模型选择k ={20,40,60,80,100}的值。

其中，Q和Rp分别表示所有目标药物和为 seed medications p提供的top-k推荐列表。

（2）Mean average precision. 

通过检查相关药物是否出现在top-k推荐列表中来评估MR模型的重要性。

![image-20230817130754120](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817130754120.png)

AP是精确率-召回率曲线（PR曲线）下方的面积，它衡量了算法在不同置信度阈值下的性能。mAP是所有类别AP的平均值，它是目标检测算法性能的综合评估指标。

*GTP* 代表 Ground Truth Positive，它指的是与患者诊断实际相关的药物数量。 -*i* 是一个变量，用于迭代前 k 种推荐药物。 tpseen代表 True Positive seen，指的是排名前 k 的药物中推荐的相关药物数量。 -该公式计算每个召回级别的精度，并计算所有级别的精度值的平均值，以获得最终的 AP @k 分数。 -AP @k 分数越高，药物推荐模型的表现就越好。

（3）Normalized discounted cumulative gain

标准化贴现累积收益 (ndCG) 是用于评估药物推荐 (MR) 模型有效性的指标。它评估真正相关药物在Top-N推荐列表中的位置或排名。该指标考虑了推荐药物的分级相关性。分级相关性意味着药物的相关性不仅是二进制的（相关或不相关），而且可以根据其与患者病情的相关程度进行分级。 

![image-20230817131950316](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817131950316.png)

提到的第一个指标是 nDCGg，它代表等级 g 的the accumulated normalized gain。该指标衡量在某个等级 g 之前的推荐药物的相关性，其中 G 是至位置 g 的相关药物清单。推荐药物的相关性是使用其相关度的加权总和计算的，称为折扣累积收益 (DCG)。为了对 DCG 分数进行标准化，使用了理想排序DCG(IDCGg)。假设排名靠前的相关药物出现在推荐列表的顶部，IDCGGg代表给定等级 g 下可能的最大 DCG 分数。

提到的第二个指标是平均互惠排名（MRR），它衡量磁共振模型在排名前k的结果列表中推荐相关药物的能力，其中 QT 是测试集，rankq 是给定查询 q 中第一个基本真相药物的等级。MRR 是根据测试集中所有查询中基本真相药物的倒数等级的平均值计算的。 这些评估指标对于评估基于深度学习的药物推荐模型的性能和比较其有效性非常重要

![image-20230817132618937](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817132618937.png)

（4）Accuracy

计算药物预测的优势，即对下一种推荐药物的不正确/正确猜测[101]。

![image-20230817160917708](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817160917708.png)

True Positive @n 是指模型为患者正确推荐前 n 种药物的次数。测试数据集的大小用 |d_test| 表示。

（5）F-measure

F-measure 是用于评估药物推荐模型性能的指标。它通过谐波均值结合了另外两个指标，即精度和召回率。

![image-20230817161248821](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817161248821.png)

（6）Area under curve

突出显示的文本是指使用曲线下方区域（AUC）指标来评估作为分类任务制定的药物推荐（MR）模型。 阳性样本的预测分数（pj）是患者对药物产生积极反应的可能性，而阴性样本的预测分数（nk）是患者对药物产生负面反应的可能性。Np和Nn分别表示正样本总数和负样本总数。AUC 指标衡量 MR 模型区分正样本和阴性样本的能力，AUC 越高表示性能越好。

![image-20230817162216462](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817162216462.png)

（7）Jaccard similarity

Jaccard 相似度是衡量两个节点或向量之间相似度的指标。 该方程计算了基本真值 Yt 和预测结果 Yt_hat的交集与 Yt 和 Yt_hat 的并集之比。 -基本真值 Yt 是指目标变量的实际值，而预测结果 Yt_hat 是指模型预测的值。 -从公式 34 中获得的比率范围为 0 到 1，其中 0 表示无相似性，1 表示完全相似。 -Jaccard 相似性在数据稀疏的情况下（即大多数值为零时）特别有用。 -用N表示的患者总数。

(8)DDI rate

 -DDI 代表药物-药物相互作用，指的是两种或多种药物同时服用时可能产生的负面影响。 -DDI 率定义为模型提出的含有 DDI 的药物推荐的百分比。 -DDI 率越高，模型提出的用药建议就越不安全。

![image-20230817163804853](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817163804853.png)

-如果该组合属于 DDI 图的边缘集，则方程中的集合会计算推荐集 Y 中的每对药物（ci、cj）。 -DDI图是表示不同药物之间可能相互作用的图表。 -测试数据集的大小 (N) 和第 k 位患者的就诊次数 (Tk) 也用于计算 DDI 率。

表4报告了最广泛使用的指标是F-Score(37分中的24分)和AUC(37分中的23分)，这表明研究人员对产生准确的药物预测更感兴趣。紧随其后的是Jaccard(37个中的20个)，表明相当多的MR模型将推荐视为分类问题。其次是DDI率(37人中有13人)和召回率(37人中有11人)。**此外，大多数模型采用了度量标准的组合**。

最后，我们注意到大多数模型(37个中的21个)使用了三个或更多的评估指标，**这表明基于多个指标的评估使MR模型的实验更加稳健。**

![image-20230817165232520](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817165232520.png)

![image-20230817165240655](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817165240655.png)

##### 3.2 Datasets

**MIMIC-III**。重症医疗信息集市(MIMIC-III)是最丰富的数据集，由麻省理工学院(MIT)计算生理学实验室开发，提供对信息源的访问，包括患者、诊断记录、临床事件、程序、药物和症状

**NELL**是最新发布的数据集，仅在一个模型中使用。该数据集提供了对信息源的访问。

**ICD-9**国际疾病分类第9版(ICD-9)是诊断和程序的官方标准代码。它以表格形式包含13000种疾病代码。这些代码指定每种疾病都有一个唯一的代码，并在EHR中用于计费机制。

**eICU**是一个协作研究数据库，其中存储了入住重症监护病房(ICU)的危重患者的未识别健康记录。在这个数据集中，不同的信息因素包括诊断、生命体征、护理计划、疾病严重程度和治疗信息。

**Proprietary and non-public datasets.** 一些研究开发了专有和非公开的数据集来评估他们的MR模型。由于这些数据集提供了有限的信息来源，因此被少数研究使用。

![image-20230817165308775](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817165308775.png)

![image-20230817165314918](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230817165314918.png)

4. 模型实验结果的对比分析

**DMNC 模型**使用内存增强神经网络捕获序列视图之间的复杂交互，在 MIMIC-III 数据集上实现了最佳性能。 -**CogNet模型**利用编码器-解码器网络根据患者的历史和当前健康状况按顺序推荐药物，从而获得了第二好的性能。 -DMNC 系统有两种内存访问模式：后期融合和早期融合，允许特定视图或跨内存访问。 -如果当前就诊的疾病与以前的就诊一致，**CogNet模型**使用复制模块立即从历史药物组合中复制相关药物。

-诊断和程序编码器是基于变压器的网络，**PREMIER**是表现第三好的网络，它使用基于注意力的RNN和图形网络对患者就诊和药物并发事件进行建模。 -**MERITS** 使用神经常微分方程（Neural ODE）来表示时间序列依赖关系，并通过自我注意力和编码器-解码器架构整合了静态和动态特征，从而优于非公开数据集上的其他模型。 -通过结合MLP和GCN来分别融合症状表现并学习症状和草药表现，**SMGCN**在中医数据集上的表现优于MedRec。 -由于只有一个模型使用每个数据集来报告其性能，因此无法对其他数据集的性能进行有意义的比较。

#### 5. OPEN ISSUES AND OPPORTUNITIES

##### 5.1 Cold-start Problem

进一步分类为冷启动患者和药物。在这些情况下，由于对患者和药物的了解不足，该方法无法提供值得信赖的药物建议。为了解决冷启动问题，大多数模型采用了用药史、时间、诊断和程序。

**5.2 Sparsity**

当数据集或患者信息中缺少信息时，磁共振模型中的 CF 技术会面临稀疏性问题。 -稀疏性问题可以通过使用次要信息和附带信息来增强对患者的了解来解决。本研究中研究的大多数方法采用结合CF和CB的混合策略来解决数据稀疏性问题。用于生成个性化药物建议的DL技术是它们之间的主要区别。

**5.3 Drug-Drug Adverse Interactions**

-药物推荐模型应考虑药物之间的相互作用，以避免对患者健康产生不良影响。GameNet、4sDrug和CogNet等不同的模型提出了解决方案，以确保安全和个性化的药物推荐。 -**GameNet**将存储模块与图形卷积网络相结合，对患者的纵向记录进行建模。**4sDrug**引入了带有处罚措施的药物套装模块，以确保小而安全的药物推荐。**CogNet** 使用编码器-解码器架构和复制模块来考虑患者的历史就诊信息。

使用分层选择机制来计算每种药物的复制概率，将就诊和药物水平分数相结合。 -诸如**ARMR和SARMR**之类的技术使用RNN和GAN模型来生成患者表现并调整其分布以减少药物相互作用（DDI）。**SafeDrug** 自适应地合并了监督损失和无监督的 DDI 限制，以解决 DDI 问题。

**5.4 Capturing Temporal Dynamics**

患者最近的健康状况和检查对于推荐精确的药物非常重要。 -不同的疾病需要不同类型的患者记录才能做出准确的预测和建议。 -已经提出了各种模型，例如RETAIN、Dipole、Concare、meSin和TahdNet，来处理使用病历对未来诊断的预测。 -这些模型采用了基于注意力的双向 GRU、多通道医学特征嵌入、交互式时间序列学习和时间感知模块等技术，以提高预测准确性。

**5.5 Personalized Patient’s Modeling**

-**ConCare** 使用多头自我注意力来提取临床特征之间的依赖关系，并在个人健康背景下重新生成特征嵌入。 -**G-BERT** 集成了 GCN 和 BERT，通过对 EHR 数据进行预训练，分别学习医疗法规表示和药物推荐。 -**AmaNet** 将注意力机制和记忆相结合，学习视图内和视图间互动，维护局部和全局知识存储系统。**MARITS** 使用 Neural ODE 来捕获不规则的时间序列依赖关系，并应用基于注意力的编码器-解码器框架来合并患者和用药史。**ARMR** 利用两个 GRU 网络为预测生成可靠的患者表达。

**6.结论与启示**

大多数个性化用药预测模型都将用药史、诊断、时间和手术作为数据因素。 此外，使用辅助信息的模型，如用药史、诊断、时间、程序、症状、体检等，可以提供精确的建议，缓解稀疏性问题。

-基于嵌入的方法和 RNN 通常用于基于深度学习的药物推荐方法。 rnn紧随其后，因为它们在NLP任务和捕获远程依赖关系方面表现良好。其次是CNN变体，因为它们可以利用上下文细节并捕获本地相关特征。

-基于transform的带有注意力网络的模型因捕捉患者与药物之间的复杂关系而越来越受欢迎。

 -Adam 优化技术广泛用于药物推荐模型，然后是梯度下降。 

-MIMIC-III 数据集是最常用的药物推荐数据集，而其他数据集则由少数模型使用。

调查表明，图/网络嵌入方法更好地解决了稀疏性和冷启动问题。其主要原因是GCN将疾病、症状、药物、患者及其相应关系嵌入到一个共享的低维空间中
