### DBCL

#### Abstract

域不变表示应该对不同类型的伪造具有鲁棒性。

根据这一原则，我们提出了一种新的双分支协作学习(DBCL)框架。首先，利用快速傅里叶变换生成潜在域，并在此基础上构建由多对(即“源→目标”和“潜在→目标”)组成的新的自适应空间，使DBCL能够在统一的视角下进行图像级和特征级对齐。

其次，我们的DBCL通过知识蒸馏为目标领域分配高质量的伪标签，并采用动态更新模块对这些标签进行细化，从而减轻伪标签噪声对领域自适应的不利影响。

通过我们的DBCL，三个域倾向于被压缩成一个新的紧凑分布(如红色椭圆所示)，从而产生判别域不变表示。

![image-20230829171049803](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230829171049803.png)

注解：

**鲁棒**是Robust的音译，也就是健壮和强壮的意思。AI模型的鲁棒可以理解为模型对数据变化的容忍度。假设数据出现较小偏差，只对模型输出产生较小的影响，则称模型是鲁棒的。

**Dual-Branch Collaborative Learning**利用两个并行的神经网络，一个用于学习全局特征，另一个用于学习局部特征。

**傅立叶变换**在图像处理重要作用：
1.图像增强与图像去噪
绝大部分噪音都是图像的高频分量，通过低通滤波器来滤除高频——噪声;  边缘也是图像的高频分量，可以通过添加高频分量来增强原始图像的边缘；
2.图像分割之边缘检测
提取图像高频分量
3.图像特征提取：
形状特征：傅里叶描述子
纹理特征：直接通过傅里叶系数来计算纹理特征
其他特征：将提取的特征值进行傅里叶变换来使特征具有平移、伸缩、旋转不变性
4.图像压缩
可以直接通过傅里叶系数来压缩数据；常用的离散余弦变换是傅立叶变换的实变换；
原文链接：https://blog.csdn.net/l641208111/article/details/106582201

-**图像级对齐**涉及对齐来自不同领域的图像的视觉特征和属性。这种对齐方式可确保图像具有相似的视觉属性，从而更容易比较和检测 deepfake 的伪造品。

-**特征级对齐**侧重于对齐从不同领域提取的特征或图像的表示形式。这种调整旨在创建域不变特征，这些功能可以抵御各种类型的伪造行为。通过调整功能，deepfake 检测模型可以有效地学习和区分真实图像和经过处理的图像。

#### 介绍

深度伪造检测技术可以简化为一个**二元分类问题**，旨在区分人脸是真实的还是伪造的。

域泛化：UDA技术（没有利用跨域知识）、基于自训练的知识蒸馏技术（域之间的显著差异会影响标签质量）。

DBCL的优点：（1）我们的DBCL采用了一个有两个分支的师生网络。在这种设置中，学生网络通过跨多个配对域的域对齐来增强教师网络生成的伪标签的质量。同时，教师网络采用动态更新策略，为学生网络提供可靠的伪标签，从而减少伪标签中潜在的错误噪声。

（2）第一次通过领域对齐和知识蒸馏以相互加强的方式进行深度伪造检测。

#### 相关工作

（1）图像级对齐。这些方法主要通过风格转移等技术实现，数据增强，以及图像混合。

（2）特征级对齐。这种方法旨在减少两个域之间的分布偏移。

（3）当伪标签包含噪声(即不正确的类别)时，它会对模型优化产生不利影响。因此，一些研究侧重于提高伪标签的质量，而其他人则专注于降低噪声以帮助模型优化。

注释：

所谓**风格迁移**，其实就是提供一幅画(Reference style image)，将任意一张照片转化成这个风格，并尽量保留原照的内容(Content)。

[Style Transfer | 风格迁移综述 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/57564626)

**图像混合**就是将两个尺寸一样的图像按照一定的比例混合到一起或者高低频结合？

[opencv——图像混合_opencv 图像 混合_Spark！的博客-CSDN博客](https://blog.csdn.net/qq_28258885/article/details/112527018)

训练集和测试集并不来自同一个分布。这就是所谓的**分布偏移**

#### Method

**DBCL框架**可以将在标记的源领域训练的模型转移到未标记的目标领域。

![image-20230829185415888](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230829185415888.png)



来自第一个分支的Ft1和Fs1用于“DS→DT”对上的域对齐和知识蒸馏，而来自第二个分支的Ft2和Fs2处理“DL→DT”对内的相同过程。为了改进由Ft1和Ft2生成的伪标签y，我们引入了动态更新模块(DUM)，减轻了伪标签噪声对Fs1和Fs2优化的不利影响。

Fs1和Fs2通过对抗性学习执行特征对齐，分别关于DT的生成域不敏感特征和另一个域。

XT同时作为Ft1和Ft2的输入，从不同的域对中提取更全面的知识(即伪标签)，并将其用作相应的Fs1和Fs2的监督标签。

在Fs1中，输入XS和XT依次经过特征提取器、对抗鉴别器和域分类器。通过对抗学习，该模型无法区分特征提取器的输出特征是来自DS还是DT，从而获得域不变表示。为了以端到端方式训练学生网络，我们在特征提取器和域分类器之间引入了梯度反转层(GRL) 。

![image-20230831102855013](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230831102855013.png)

（1）具体来说，我们使用FFT将XS的振幅替换为XT的振幅，生成类目标图像XL。

（2）**当DT中的XT缺少标记时**，Fs1的损失函数可视为UDA损失，表示为:

![image-20230829193129107](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230829193129107.png)

式中，Yd={0,1}表示域标签，λadv为平衡UDA损失中两个分量重要性的权重，![image-20230829193138552](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230829193138552.png)

<u>**分别代表监督和对抗负对数似然损失，用于区分真假人脸和从这些域对特征进行分类？(如何做到的）**</u>

（3）在每个分支中，我们利用Adam优化器更新Fs的参数，然后使用这些更新的参数通过指数移动平均线(EMA)更新Ft的参数，对于教师网络的优化，我们利用EMA将参数从学生网络传播到教师网络，其可以表示为:

![image-20230829193506423](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230829193506423.png)

其中，θt1和θs1分别表示Ft1和Fs1的参数，α表示EMA的平滑系数，它决定了Ft1参数更新的权重。**对于XT, Ft1将预测它是真还是假，并使用预测结果作为XT的伪标签。**

（4）为了提高教师网络生成伪标签的可靠性，我们提出了一个动态更新模块(DUM)来细化伪标签，如图3所示。

![image-20230829194138952](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230829194138952.png)

我们引入两个dropout层，分别从Ft1和Ft2中生成n个预测，然后计算n个预测结果的标准差σ：

![image-20230829194310030](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230829194310030.png)

![image-20230829194419501](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230829194419501.png)

![image-20230829194616251](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230829194616251.png)

通过比较σ1和σ2的值，我们**选择不确定性较低的教师网络来生成伪标签**。XT的精伪标签可由下式得到:

![image-20230829194826188](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230829194826188.png)

Fsi (i= 1,2)的预测概率值ξ si可以调整如下:

![image-20230830085304745](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830085304745.png)

其中ε为平滑因子。**当XT得到细化的伪标签y**，我们使用交叉熵损失![image-20230830085406178](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830085406178.png)来优化Fsi为:

![image-20230830085428709](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830085428709.png)

因此，**可以将Eq.(1)中的UDA损失转化为半监督域自适应损失**。因此，Fs1和Fs2的总损失函数可表示为:

![image-20230830085500359](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830085500359.png)

其中λce是用于控制![image-20230830085608018](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830085608018.png)重要性的超参数。

如算法1所示，我们分别用优化后的θs1和θs2得到了Fs1和Fs2。

注释：

**平滑因子**是指用于计算加权平均值的权重，通常为0到1之间的数值。较高的平滑因子会使得过去的数据对平均值的影响更大，而较低的平滑因子则会使得当前数据对平均值的影响更大。

**平滑系数**是指平滑因子的倒数，即1除以平滑因子。它表示了数据中过去的值对当前平均值的影响程度，因此较高的平滑系数会使得过去的数据对当前平均值的影响更小，而较低的平滑系数则会使得过去的数据对当前平均值的影响更大

#### Experiments

##### 数据库

（1）FF++ dataset

720个vedio用于训练，各140个用于验证和测试。

4000个用FaceSwap(FS), Face2Face (F2F), DeepFake (DF), and NeuralTextures
(NT)从真视频中产生的假视频。

原始视频被压缩为两个级别：high-quality videos (HQ) and low-quality videos(LQ)。

**对于FF++**，我们遵循标准设置(Rossler等人2019)，从每个视频中随机选择100帧，并使用Dlib (PYTHON里面的库)从图像中提取人脸。

（2）Celeb-DF-v2 dataset

提供真实视频590个，虚假视频5639个。这些假人脸视频是通过改进的深度假合成技术生成的。

我们从5711个视频中提取人脸图像用于**训练**，从518个视频中提取人脸图像用于**测试**。

（3）ForgeryNet dataset

包括四个任务中的图像级和视频级数据:图像伪造分类、空间伪造定位、视频伪造分类和时间伪造定位。在这项工作中，**我们专注于图像伪造分类**，其中包含2,351,305张用于训练的图像和158,201张用于评估的图像。

对于ForgeryNet，我们使用图像子集，并通过应用人脸检测器RetinaFace生成面部图像补丁。

[目前最好的人脸检测算法，RetinaFace论文精读 - 简书 (jianshu.com)](https://www.jianshu.com/p/d4534ac94a65)

细节：为了**防止过拟合**，我们对训练数据应用随机数据增强(即水平翻转、旋转、添加高斯噪声、颜色变换和擦除增强在我们的DBCL框架中，我们使用**Xception**作为Ft1, Ft2, Fs1和Fs2的骨干网络。参数θt1， θt2， θs1和θs2使用在ImageNet上预训练的Xception模型进行**初始化**。

对于**超参数**，我们设α=0.994, n=5， λce=1.0， λadv=0.1， ε=0.1。我们在**PyTorch**中实现DBCL框架。使用基本**学习率**为0.0002的Adam优化器对Fs1和Fs2进行优化。

**评价指标和比较方法**。遵循标准设定(Rossler et al . 2019;halassos等人(2021)，我们使用接收器下面积(AUC)作为评估指标。AUC(%)显示了真假人脸的可分性。为了证明我们方法的有效性，我们将其与几种最先进的方法进行了比较:FDA， LipForensics ，CORE ，UIA-ViT 、DCL和IID .

##### 消融实验

（1）在线调整策略的有效性。如Eq.(4)所示，我们引入了一种更新方法来改进伪标签，防止从教师网络中提取的历史知识丢失。对于教师网络的预测，我们评估了**使用在线调整方法和不使用在线调整方法在F2F中训练和测试图像的伪标签的准确性**。

![image-20230830161954255](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830161954255.png)

训练数据只提高了1.46%，而测试数据提高了5.37%。这是因为我们的OA策略从训练集中提取知识。虽然它对训练集本身提供的帮助很小，但它对模型适应测试集有很大的帮助。

（2）平滑贴标策略的有效性。如Eq.(6)所示，我们引入了一种标记策略来更好地利用伪标签。如表2所示。

![image-20230830163806116](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830163806116.png)

此外，我们在Eq.(6)中探讨了不同平滑因子下目标域的检测性能。如图4所示，

![image-20230830163842034](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830163842034.png)

当**平滑因子设置为0.1**时，三种域自适应对的检测性能都较优。

（3）拟议的两分支框架的有效性。

![image-20230830164029960](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830164029960.png)

单分支框架总结如下：1使用exception网络作为学生的主干，单独使用源数据进行优化，2利用潜域，通过自我训练优化学生网络。3和4分别利用源域和潜域通过对抗性学习来优化学生网络。两分支框架包括:5采用一致性约束策略为目标域生成伪标签。6我们提出的DBCL框架使用DUM来细化这些伪标签。

注释：

**消融实验**：设立对照组的意思，通过去除某个模块的作用，来证明该模块的必要性，如果消融实验后得到结果不好或者性能大幅下降，说明该模块起到了作用

**AUC**（ROC曲线下面积）是ROC曲线下的面积，用于衡量分类器性能。AUC值越接近1，表示分类器性能越好；反之，AUC值越接近0，表示分类器性能越差。

[一文详解ROC曲线和AUC值 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/616190701)漏诊率和误诊率

[AUC含义的通俗理解_曲线下面积(auc)的意义_Arsener_gong的博客-CSDN博客](https://blog.csdn.net/qq_38032064/article/details/104929458)

##### 与最先进方法的比较

我们在**域内评价和跨数据集评价**两个方面进行了大量的实验。

我们训练了一个异常网络(作为二值分类的**基线**。在每个实验中，我们先在单一伪造方法生成的图像上训练模型，然后在其他伪造方法生成的图像上计算AUC值(%)。

![image-20230830164810503](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830164810503.png)

特征空间的t-SNE可视化（降维可视化技术）。对于每个类别(例如真实/虚假)，我们的DBCL比基线模型(例如异常)更好地对齐了特征。

![image-20230830164922464](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830164922464.png)

注释：

[t-SNE：可视化效果最好的降维算法 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/327699974)

在跨数据实验中，我们采用FF++ (HQ)作为源数据集，Celeb-DF-v2和ForgeryNet作为目标数据集。我们在相同的实验设置下应用不同的方法(即FDA 、LipForensics 、CORE、UIA-ViT 、DCL 和IID)来比较它们的性能。对比结果见表5。

![image-20230830165424120](C:\Users\lxc\AppData\Roaming\Typora\typora-user-images\image-20230830165424120.png)

#### 结论

考虑到实时应用需求，未来我们将重点优化跨域深度伪造检测方法的速度。

